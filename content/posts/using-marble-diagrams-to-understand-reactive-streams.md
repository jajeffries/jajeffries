---
title: 'Using Marble Diagrams to Understand Reactive Streams'
date: Sat, 24 Jan 2015 13:29:56 +0000
draft: false
tags: []
---

When working with complex streams of data in Rx, I often find it useful to visualise what is happening in each step of the process. A good way of doing this is using marble diagrams. Marble diagrams let you split up and visualise each step using examples, which you can easily convert into code. Let's start with looking at an empty stream to get a hang on the basics. \[code\] ------------------------> \[/code\] The dashes show a stream with no data on it. If we put some data on there, in this case some numbers generated by \[code\]Rx.Observable.interval(1000)\[/code\] in RxJS for example. \[code\] -0-1-2-3-4-5-6-7-8-9-10--> \[/code\] Now that we have a stream of data, we can apply an operation to it. Let's try filtering out the odd numbers. \[code\] -0-1-2-3-4-5-6-7-8-9-10--> filter odd numbers v v v v v v v v v v -0---2---4---6---8---10--> \[/code\] No we have a second stream, with just the even numbers. We would use the same technique to visualise any transformation to the stream. For example, we could turn everything into 1. \[code\] -0-1-2-3-4-5-6-7-8-9-10-> turn everything into 1 v v v v v v v v v v v -1-1-1-1-1-1-1-1-1-1-1--> \[/code\] I like the fact that we can still visualise two streams, as it shows that both streams are still there, but we can still see that the one we are focussing on is the bottom one. Now, lets complete one of the streams by just taking the first three. In RxJs we could use the [take method](https://github.com/Reactive-Extensions/RxJS/blob/master/doc/api/core/operators/take.md). This would cause our on complete callback to be called after the third item. \[code\] -0-1-2-3-4-5-6-7-8-9-10--> filter odd numbers v v v v v v v v v v -0---2---4---6---8---10--> take first 3 v v v v v v -0---2---4---| \[/code\] We've introduced an new piece of syntax to our marble diagram here. The pipe symbol | represents when a stream completes. Let's have a look at a code example, which I'm sure will explain it much better than I have. \[code language="js"\] Rx.Observable.interval(1000) .filter(function(x) { return x % 2 == 0; }) .take(3) .subscribe( function (x) { console.log('Next: ' + x); }, function (err) { console.log('Error: ' + err); }, function () { console.log('Completed'); }); \[/code\] Output: \[code\] Next: 0 Next: 2 Next: 4 Completed \[/code\] [Here is a jsfiddle](http://jsfiddle.net/19zhmwcv/) in case you want to have a play around. Now we have seen how to represent changes in a stream and completed streams, we should look at representing errors. Let's go back to our original stream. \[code\] -0-1-2-3-4-5-6-7-8-9-10--> \[/code\] Let's say that after emitting the first few items, the stream errors, causing the error callback to be called. In a marble diagram we represent this with an X. \[code\] -0-1-2-3-X \[/code\] This will cause the streams onError callback to be called allowing you to deal with it however you see fit. Let's have a look at a variation of the code from our previous example. \[code language="js"\] Rx.Observable.interval(1000) .subscribe( function (x) { console.log('Next: ' + x); }, function (err) { console.log('Error: ' + err.name); }, function () { console.log('Completed'); }); \[/code\] Given our stream with an error and the error produced was a TypeError, this code would output: \[code\] Next: 0 Next: 1 Next: 2 Next: 3 Error: TypeError \[/code\] So now I've shown you the basics you should be able to draw your own marble diagrams next time you're designing some reactive code. [Let me know](https://jajeffries.wordpress.com/about-me/ "About me") how it goes and if there are any parts that you find more difficult than others.